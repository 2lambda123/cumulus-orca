<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Deploying ORCA with Cumulus | Operational Recovery Cloud Archive (ORCA)</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Deploying ORCA with Cumulus | Operational Recovery Cloud Archive (ORCA)"><meta data-react-helmet="true" name="description" content="Provides developer information for ORCA code deployment with Cumulus."><meta data-react-helmet="true" property="og:description" content="Provides developer information for ORCA code deployment with Cumulus."><meta data-react-helmet="true" property="og:url" content="https://nasa.github.io/cumulus-orca//cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus"><link data-react-helmet="true" rel="shortcut icon" href="/cumulus-orca/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nasa.github.io/cumulus-orca//cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus"><link rel="stylesheet" href="/cumulus-orca/styles.cb12f2af.css">
<link rel="preload" href="/cumulus-orca/styles.16303b44.js" as="script">
<link rel="preload" href="/cumulus-orca/runtime~main.5db2d976.js" as="script">
<link rel="preload" href="/cumulus-orca/main.0c1b3587.js" as="script">
<link rel="preload" href="/cumulus-orca/2.32bf4f13.js" as="script">
<link rel="preload" href="/cumulus-orca/42.f5120a7c.js" as="script">
<link rel="preload" href="/cumulus-orca/43.774890db.js" as="script">
<link rel="preload" href="/cumulus-orca/935f2afb.4905fe57.js" as="script">
<link rel="preload" href="/cumulus-orca/41.66200ddc.js" as="script">
<link rel="preload" href="/cumulus-orca/7c9fa1db.eadd3234.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/cumulus-orca/"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Operational Recovery Cloud Archive (ORCA)</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/cumulus-orca/docs/about/introduction/orca-intro">About ORCA</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cumulus-orca/docs/developer/quickstart/developer-intro">Developer Guide</a><a class="navbar__item navbar__link" href="/cumulus-orca/docs/cookbook/cookbook-intro">ORCA Cookbooks</a><a class="navbar__item navbar__link" href="/cumulus-orca/docs/operator/operator-intro">Operator Guide</a><a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/cumulus-orca/"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/cumulus-orca/img/cumulus-orca-logo.svg" alt="ORCA site logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Operational Recovery Cloud Archive (ORCA)</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cumulus-orca/docs/about/introduction/orca-intro">About ORCA</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/cumulus-orca/docs/developer/quickstart/developer-intro">Developer Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/cumulus-orca/docs/cookbook/cookbook-intro">ORCA Cookbooks</a></li><li class="menu__list-item"><a class="menu__link" href="/cumulus-orca/docs/operator/operator-intro">Operator Guide</a></li><li class="menu__list-item"><a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/quickstart/developer-intro">Developer Quick Start Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development Guide</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Developing Code</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/code/contrib-code-intro">Code Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/code/setup-dev-env">Setting Up a Dev Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/code/best-practices">Best Practices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/code/linting">Running PyLint Against Your Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/code/unit-tests">Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/code/postgres-tests">Postgres Tests</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Developing Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/documentation/contrib-documentation-intro">Documentation Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/documentation/contrib-documentation-env">Development Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/documentation/contrib-documentation-add">Adding New Content</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/documentation/contrib-documentation-templates">Documentation Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/documentation/contrib-documentation-tasks">Task Documentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/documentation/documentation-style-guide">Documentation Style Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cumulus-orca/docs/developer/development-guide/documentation/contrib-documentation-deploy">Deploying Documentation</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment">Deployment Information</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment-environment">Creating a Deployment Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket">Creating the Glacier Bucket</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus">Deploying ORCA with Cumulus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cumulus-orca/docs/developer/deployment-guide/testing_deployment">Testing Deployment</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Deploying ORCA with Cumulus</h1></header><div class="markdown"><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Prior to following this document, make sure that your <a href="/cumulus-orca/docs/developer/deployment-guide/deployment-environment">deployment environment</a>
is setup and an <a href="/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket">ORCA archive glacier bucket</a> is
created.</p></div></div><p>ORCA is meant to be deployed with Cumulus. There are two methods for deploying
ORCA. The first method involves modifying files in the Cumulus <code>cumulus-tf</code>
deployment to deploy ORCA with Cumulus. The second method involves deploying ORCA
as a separate module after the Cumulus deployment.</p><p>The general steps to deploy ORCA are:</p><ol><li>Configure the ORCA deployment using one of the two methods.</li><li><a href="#define-the-orca-wokflows">Define the ORCA Ingest and Recovery workflows.</a></li><li><a href="#deploy-orca-with-terraform">Deploy ORCA using terraform.</a></li><li><a href="#collection-configuration">Configure ORCA in the collection configuration of the running Cumulus instance.</a></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuring-the-cumulus-deployment-to-use-orca"></a>Configuring the Cumulus Deployment to use ORCA<a class="hash-link" href="#configuring-the-cumulus-deployment-to-use-orca" title="Direct link to heading">#</a></h2><p>Follow the instructions for <a href="https://nasa.github.io/cumulus/docs/deployment/deployment-readme" target="_blank" rel="noopener noreferrer">deploying Cumulus</a>
on the Cumulus website through the configuration of the Cumulus module <code>cumulus-tf</code>.</p><p>Prior to deploying the <code>cumulus-tf</code> module, the following files need to be
modified to deploy ORCA with Cumulus.</p><ul><li>main.tf</li><li>variables.tf</li><li>terraform.tfvars</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modifying-cumulus-tfmaintf"></a>Modifying <code>cumulus-tf/main.tf</code><a class="hash-link" href="#modifying-cumulus-tfmaintf" title="Direct link to heading">#</a></h3><p>At the end of the <code>main.tf</code> file, add the following code and update the source
variable.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Only change the value of source</h5></div><div class="admonition-content"><p>Only change the value of <code>source</code> in the code example below to point to the
proper ORCA version. The ORCA version is specifed right after <em>download</em> in the
URL path to the release. In the example above the release being used is v2.0.1.</p></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-terraform codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ORCA Module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;orca&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  source                         = &quot;https://github.com/nasa/cumulus-orca/releases/download/v2.0.1/cumulus-orca-terraform.zip//modules/orca&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  vpc_id                         = module.ngap.ngap_vpc.id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  subnet_ids                     = module.ngap.ngap_subnets_ids</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  workflow_config                = module.cumulus.workflow_config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  region                         = var.region</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  prefix                         = var.prefix</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  permissions_boundary_arn       = var.permissions_boundary_arn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  buckets                        = var.buckets</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  platform                       = var.platform</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_name                  = var.database_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_port                  = var.database_port</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  postgres_user_pw               = var.postgres_user_pw</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_app_user              = var.database_app_user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_app_user_pw           = var.database_app_user_pw</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  drop_database                  = var.drop_database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ddl_dir                        = var.ddl_dir</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_timeout                 = var.lambda_timeout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  restore_complete_filter_prefix = var.restore_complete_filter_prefix</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  copy_retry_sleep_secs          = var.copy_retry_sleep_secs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default_tags                   = var.default_tags</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="required-values-unique-to-the-orca-module"></a>Required Values Unique to the ORCA Module<a class="hash-link" href="#required-values-unique-to-the-orca-module" title="Direct link to heading">#</a></h4><p>The following variables are unique to the ORCA module. More information about
these variables can be found in the <a href="#orca-variables">variables section</a>.</p><ul><li>platform</li><li>database_name</li><li>database_port</li><li>postgres_user_pw</li><li>database_app_user</li><li>database_app_user_pw</li><li>drop_database</li><li>ddl_dir</li><li>lambda_timeout</li><li>restore_complete_filter_prefix</li><li>copy_retry_sleep_secs</li><li>default_tags</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="required-values-retrieved-from-cumulus-variables"></a>Required Values Retrieved from Cumulus Variables<a class="hash-link" href="#required-values-retrieved-from-cumulus-variables" title="Direct link to heading">#</a></h4><p>The following variables are set as part of your Cumulus deployment. ORCA utilizes
these same variables for the build. More information about these variables can
be found in the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf" target="_blank" rel="noopener noreferrer">Cumulus variable definitions</a>.</p><ul><li>region</li><li>prefix</li><li>permissions_boundary_arn</li><li>buckets</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="required-values-retrieved-from-other-modules"></a>Required Values Retrieved from Other Modules<a class="hash-link" href="#required-values-retrieved-from-other-modules" title="Direct link to heading">#</a></h4><p>The following variables are set by retrieving output from other modules. This is
done so that the user does not have to lookup and set these variables after a
deployment. More information about these variables can be found in the
<a href="https://github.com/nasa/cumulus/blob/master/tf-modules/cumulus/variables.tf" target="_blank" rel="noopener noreferrer">Cumulus variable definitions</a>.</p><ul><li>vpc_id</li><li>subnet_ids</li><li>workflow_config</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modifying-cumulus-tfvariablestf"></a>Modifying <code>cumulus-tf/variables.tf</code><a class="hash-link" href="#modifying-cumulus-tfvariablestf" title="Direct link to heading">#</a></h3><p>At the end of the <code>variables.tf</code> file, add the following code.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-terraform codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">## ORCA Variables Definitions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;platform&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;AWS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Indicates if running locally (onprem) or in AWS (AWS).&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_name&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;orca&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Name of the ORCA database that contains state information.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_port&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;5432&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Port the database listens on.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;postgres_user_pw&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;postgres database user password.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_app_user&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;orca_user&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;ORCA application database user name.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_app_user_pw&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;ORCA application database user password.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;drop_database&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;False&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Tells ORCA to drop the database on deployments.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;ddl_dir&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;ddl/&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;The location of the ddl dir that contains the sql to create the application database.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;lambda_timeout&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = 300</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Lambda max time before a timeout error is thrown.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;restore_complete_filter_prefix&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;copy_retry_sleep_secs&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;How many seconds to wait between retry calls to `copy_object`.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;default_tags&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = object({ team = string, application = string })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    team : &quot;DR&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    application : &quot;disaster-recovery&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modifying-cumulus-tfterraformtfvars"></a>Modifying <code>cumulus-tf/terraform.tfvars</code><a class="hash-link" href="#modifying-cumulus-tfterraformtfvars" title="Direct link to heading">#</a></h3><p>At the end of the <code>terrafor.tfvars</code> file, add the following code. Update the
variable values to the values for your particular environment.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The example below shows the minimum variables to set for the module and accepting
default values for the rest. The ORCA variables section provides additional
information on variables that can be set for the ORCA application. In some cases
additional variable definitions may be needed.</p></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-terraform codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">## ORCA Configuration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">database_app_user_pw = &quot;my-orca-application-user-password&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">postgres_user_pw     = &quot;my-super-secret-database-owner-password&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Below describes the type of value expected for each variable.</p><ul><li><code>database_app_user_pw</code> - the password for the application user</li><li><code>postgres_user_pw</code> - password for the postgres user</li></ul><p>Additional variable definitions can be found in the <a href="#orca-variables">ORCA variables</a>
section of the document.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>The cumulus bucket variable will have to be modified to include the
disaster recovery bucket <strong>glacier</strong>. An example can be seen below.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-terraform codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">buckets = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  glacier = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-glacier&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;glacier&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  internal = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-internal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;internal&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-private&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;private&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  protected = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-protected&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;protected&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;orca-public&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type = &quot;public&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuring-orca-as-a-standalone-module-with-cumulus"></a>Configuring ORCA as a Standalone Module with Cumulus<a class="hash-link" href="#configuring-orca-as-a-standalone-module-with-cumulus" title="Direct link to heading">#</a></h2><p>To deploy ORCA as a separate module, create an orca-tf folder in your Cumulus
deployment and perform the steps laid out below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configure-terraform"></a>Configure Terraform<a class="hash-link" href="#configure-terraform" title="Direct link to heading">#</a></h3><p>The state of the Terraform deployment is stored in S3. In the following
examples, it will be assumed that state is being stored in a bucket called
<code>dr-tf-state</code>. You can also use an existing bucket, if desired.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-the-state-bucket"></a>Create the state bucket:<a class="hash-link" href="#create-the-state-bucket" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-shell codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws s3api create-bucket </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --bucket dr-tf-state </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --create-bucket-configuration </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">LocationConstraint</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">us-west-2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The <code>--create-bucket-configuration</code> line is only necessary if you are creating your bucket outside of <code>us-east-1</code>.</p></div></div><p>In order to help prevent loss of state information, it is recommended that
versioning be enabled on the state bucket:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-shell codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ aws s3api put-bucket-versioning </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --bucket dr-tf-state </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --versioning-configuration </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">Status</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">Enabled</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-the-locks-table"></a>Create the locks table:<a class="hash-link" href="#create-the-locks-table" title="Direct link to heading">#</a></h4><p>Terraform uses a lock stored in DynamoDB in order to prevent multiple
simultaneous updates. In the following examples, that table will be called
<code>dr-tf-locks</code>.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>The <code>--billing-mode</code> option was recently added to the AWS CLI. You
may need to upgrade your version of the AWS CLI if you get an error about
provisioned throughput when creating the table.</p></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-shell codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ aws dynamodb create-table </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --table-name dr-tf-locks </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --attribute-definitions </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">AttributeName</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LockID,AttributeType</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">S </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --key-schema </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">AttributeName</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">LockID,KeyType</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">HASH </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --billing-mode PAY_PER_REQUEST</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configure-and-deploy-the-main-root-module"></a>Configure and deploy the <code>main</code> root module<a class="hash-link" href="#configure-and-deploy-the-main-root-module" title="Direct link to heading">#</a></h4><p>Create a <code>terraform.tf</code> file, substituting the appropriate values for <code>bucket</code>
and <code>dynamodb_table</code> in the <code>orca-tf</code> directory. This tells Terraform where to
store its remote state. See the example below for the information to add to the
file.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  backend &quot;s3&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    region         = &quot;us-west-2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    bucket         = &quot;dr-tf-state&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    key            = &quot;terraform.tfstate&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dynamodb_table = &quot;dr-tf-locks&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-the-terraformtfvars-file"></a>Create the <code>terraform.tfvars</code> file.<a class="hash-link" href="#create-the-terraformtfvars-file" title="Direct link to heading">#</a></h3><p>Create a <code>terraform.tfvars</code> file in the <code>orca-tf</code> directory. This is where you
will place input variables to Terraform. A complete list of variables is in the
<a href="#orca-variables">ORCA variables</a> section. In addition, the following Cumulus
variables must be set.</p><ul><li>buckets</li><li>ecs_cluster_instance_subnet_ids</li><li>permissions_boundary_arn</li><li>prefix</li><li>region</li><li>vpc_id</li><li>workflow_config</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-the-variablestf-file"></a>Create the <code>variables.tf</code> file.<a class="hash-link" href="#create-the-variablestf-file" title="Direct link to heading">#</a></h3><p>Create a <code>variables.tf</code> file in the <code>orca-tf</code> directory. Copy the code below and
add to the file.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-terraform codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">## Required Cumulus Variables Definitions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;buckets&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type    = map(object({ name = string, type = string }))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;permissions_boundary_arn&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type    = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = null</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;prefix&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;region&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type    = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;us-west-2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;ecs_cluster_instance_subnet_ids&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type    = list(string)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;vpc_id&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## ORCA Variables Definitions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;platform&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;AWS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Indicates if running locally (onprem) or in AWS (AWS).&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_name&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;orca&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Name of the ORCA database that contains state information.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_port&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;5432&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Port the database listens on.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;postgres_user_pw&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;postgres database user password.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_app_user&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;orca_user&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;ORCA application database user name.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;database_app_user_pw&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;ORCA application database user password.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;drop_database&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;False&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Tells ORCA to drop the database on deployments.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;ddl_dir&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;ddl/&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;The location of the ddl dir that contains the sql to create the application database.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;lambda_timeout&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = 300</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;Lambda max time before a timeout error is thrown.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;restore_complete_filter_prefix&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;copy_retry_sleep_secs&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description = &quot;How many seconds to wait between retry calls to `copy_object`.&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">variable &quot;default_tags&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type = object({ team = string, application = string })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    team : &quot;DR&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    application : &quot;disaster-recovery&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modifying-cumulus-tfterraformtfvars-1"></a>Modifying <code>cumulus-tf/terraform.tfvars</code><a class="hash-link" href="#modifying-cumulus-tfterraformtfvars-1" title="Direct link to heading">#</a></h3><p>At the end of the <code>terrafor.tfvars</code> file, add the following code. Update the
variable values to the values for your particular environment.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The example below shows the minimum variables to set for the module and accepting
default values for the rest. The ORCA variables section provides additional</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-the-maintf-file"></a>Create the <code>main.tf</code> file.<a class="hash-link" href="#create-the-maintf-file" title="Direct link to heading">#</a></h3><p>Create the <code>main.tf</code> file in the <code>orca-tf</code> director. Copy the code block below
into the main.tf file for ORCA.</p></div></div><p>Only change the value of <code>source</code> in the code example below to point to the
proper ORCA version. The ORCA version is specifed right after <em>download</em> in the
URL path to the release. In the example above the release being used is v2.0.1.</p><p>:::</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-terraform codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">provider &quot;aws&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  version = &quot;~&gt; 2.13&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  region  = var.region</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  profile = var.profile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ORCA Module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;orca&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  source                         = &quot;https://github.com/nasa/cumulus-orca/releases/download/v2.0.1/cumulus-orca-terraform.zip//modules/orca&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  vpc_id                         = var.vpc_id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  subnet_ids                     = var.ecs_cluster_instance_subnet_ids</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  workflow_config                = var.workflow_config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  region                         = var.region</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  prefix                         = var.prefix</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  permissions_boundary_arn       = var.permissions_boundary_arn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  buckets                        = var.buckets</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  platform                       = var.platform</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_name                  = var.database_name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_port                  = var.database_port</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  postgres_user_pw               = var.postgres_user_pw</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_app_user              = var.database_app_user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  database_app_user_pw           = var.database_app_user_pw</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  drop_database                  = var.drop_database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ddl_dir                        = var.ddl_dir</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_timeout                 = var.lambda_timeout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  restore_complete_filter_prefix = var.restore_complete_filter_prefix</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  copy_retry_sleep_secs          = var.copy_retry_sleep_secs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  default_tags                   = var.default_tags</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="define-the-orca-wokflows"></a>Define the ORCA Wokflows<a class="hash-link" href="#define-the-orca-wokflows" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="add-the-copy-to-glacier-step-to-an-ingest-workflow"></a>Add the Copy To Glacier Step to an Ingest Workflow<a class="hash-link" href="#add-the-copy-to-glacier-step-to-an-ingest-workflow" title="Direct link to heading">#</a></h3><p>Navigate to <code>cumulus-tf/ingest_granule_workflow.tf</code> then add the following step
anywhere after the MoveGranuleStep step being sure to change the MoveGranuleStep&#x27;s
<code>&quot;Next&quot;</code> parameter equal to &quot;CopyToGlacier&quot;.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Adjust the <code>&quot;Next&quot;</code> step in the example below to point to the proper step in
the ingest workflow.</p></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;CopyToGlacier&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;Parameters&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;cma&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &quot;event.$&quot;:&quot;$&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &quot;task_config&quot;:{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;buckets&quot;:&quot;{$.meta.buckets}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;provider&quot;: &quot;{$.meta.provider}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;collection&quot;:&quot;{$.meta.collection}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;granules&quot;: &quot;{$.meta.processed_granules}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;files_config&quot;: &quot;{$.meta.collection.files}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;Type&quot;:&quot;Task&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;Resource&quot;:&quot;${module.orca.copy_to_glacier_lambda_arn}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;Catch&quot;:[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &quot;ErrorEquals&quot;:[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;States.ALL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &quot;ResultPath&quot;:&quot;$.exception&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &quot;Next&quot;:&quot;WorkflowFailed&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;Retry&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;ErrorEquals&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           &quot;States.ALL&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;IntervalSeconds&quot;: 2,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;MaxAttempts&quot;: 3,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;BackoffRate&quot;: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;Next&quot;:&quot;WorkflowSucceeded&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">},</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modify-the-recovery-workflow-optional"></a>Modify the Recovery Workflow (<em>OPTIONAL</em>)<a class="hash-link" href="#modify-the-recovery-workflow-optional" title="Direct link to heading">#</a></h3><p>Copy the workflow from <code>workflows/workflows.yml.dr</code> into your Cumulus workflow.
Modify as needed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="orca-variables"></a>ORCA Variables<a class="hash-link" href="#orca-variables" title="Direct link to heading">#</a></h2><p><strong>Required:</strong></p><ul><li><code>ngap_subnets</code> - NGAP Subnets (array)</li><li><code>vpc_id</code> - ID of VPC to place resources in - recommended that this be a private VPC (or at least one with restricted access).</li><li><code>glacier_bucket</code> - Bucket with Glacier policy</li><li><code>public_bucket</code> - Bucket with public permissions (Cumulus public bucket)</li><li><code>private_bucket</code> - Bucket with private permissions (Cumulus private bucket)</li><li><code>internal_bucket</code> - Analogous to the Cumulus internal bucket</li><li><code>protected_bucket</code> - Analogous to the Cumulus protected bucket</li><li><code>permissions_boundary_arn</code> - Permission Boundary Arn (Policy) for NGAP compliance</li><li><code>postgres_user_pw</code> - password for the postgres user</li><li><code>database_name</code> - orca</li><li><code>database_app_user</code> - orca_user</li><li><code>database_app_user_pw</code> - the password for the application user</li></ul><p><strong>Optional:</strong></p><ul><li><code>prefix</code> - Prefix that will be pre-pended to resource names created by terraform.
Defaults to <code>dr</code>.</li><li><code>profile</code> - AWS CLI Profile (configured via <code>aws configure</code>) to use.
Defaults to <code>default</code>.</li><li><code>region</code> - Your AWS region.
Defaults to <code>us-west-2</code>.</li><li><code>restore_expire_days</code> - How many days to restore a file for.
Defaults to 5.</li><li><code>restore_request_retries</code> - How many times to retry a restore request to Glacier.
Defaults to 3.</li><li><code>restore_retry_sleep_secs</code> - How many seconds to wait between retry calls to <code>restore_object</code>.
Defaults to 3.</li><li><code>restore_retrieval_type</code> -  the Tier for the restore request. Valid values are &#x27;Standard&#x27;|&#x27;Bulk&#x27;|&#x27;Expedited&#x27;.
Defaults to <code>Standard</code>. Understand the costs associated with the tiers before modifying.</li><li><code>copy_retries</code> - How many times to retry a copy request from the restore location to the archive location.
Defaults to 3.</li><li><code>copy_retry_sleep_secs</code> - How many seconds to wait between retry calls to <code>copy_object</code>.
Defaults to 0.</li><li><code>ddl_dir</code> - the location of the ddl dir that contains the sql to create the application database.
Defaults to &#x27;ddl/&#x27;.</li><li><code>drop_database</code> - Whether to drop the database if it exists (True), or keep it (False).
Defaults to False.</li><li><code>database_port</code> - the port for the postgres database.
Defaults to &#x27;5432&#x27;.</li><li><code>platform</code> - indicates if running locally (onprem) or in AWS (AWS).
Defaults to &#x27;AWS&#x27;.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deploy-orca-with-terraform"></a>Deploy ORCA with Terraform<a class="hash-link" href="#deploy-orca-with-terraform" title="Direct link to heading">#</a></h2><p>In the proper module directory, initialize and apply changes using the commands
below.</p><ol><li>Run <code>terraform init</code>.</li><li>Run <code>terraform plan</code> #optional, but allows you to preview the deploy.</li><li>Run <code>terraform apply</code>.</li></ol><p>This commands above will create and deploy ORCA. To delete the created objects,
run <code>terraform destroy</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="collection-configuration"></a>Collection Configuration<a class="hash-link" href="#collection-configuration" title="Direct link to heading">#</a></h2><p>To configure a collection to enable ORCA, add the line
<code>&quot;granuleRecoveryWorkflow&quot;: &quot;DrRecoveryWorkflow&quot;</code> to the collection configuration
as seen below. Optionally, you can exclude files by adding values to an
<code>&quot;exclue_file_type&quot;</code> variable. For more information, see the documentation on the
<a href="https://github.com/nasa/cumulus-orca/tree/master/tasks/copy_to_glacier" target="_blank" rel="noopener noreferrer"><code>copy_to_glacier</code> task</a>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-json codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;queriedAt&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2019-11-07T22:49:46.842Z&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;sampleFileName&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW_product_0001-of-0420.h5&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;dataType&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;granuleIdExtraction&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^(.*)((\\.cmr\\.json)|(\\.iso\\.xml)|(\\.tar\\.gz)|(\\.h5)|(\\.h5\\.mp))$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;reportToEms&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;granuleId&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^.*$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;provider_path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;L0A_HR_RAW/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;meta&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;granuleRecoveryWorkflow&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DrRecoveryWorkflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;exclue_file_type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.cmr&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.xml&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.met&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="enable-recover-granule-button"></a>Enable <code>Recover Granule</code> Button<a class="hash-link" href="#enable-recover-granule-button" title="Direct link to heading">#</a></h2><p>To enable the <code>Recover Granule</code> button on the Cumulus Dashboard (available at github.com/nasa/cumulus-dashboard),
set the environment variable <code>ENABLE_RECOVERY=true</code>.</p><p>Here is an sample command to run the Cumulus Dashboard locally.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">APIROOT</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">https://uttm5y1jcj.execute-api.us-west-2.amazonaws.com:8000/dev </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ENABLE_RECOVERY</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">true </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run serve</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/nasa/cumulus-orca/edit/develop/website/docs/developer/deployment-guide/deployment-with-cumulus.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Creating the Glacier Bucket</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cumulus-orca/docs/developer/deployment-guide/testing_deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Deployment Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuring-the-cumulus-deployment-to-use-orca" class="table-of-contents__link">Configuring the Cumulus Deployment to use ORCA</a><ul><li><a href="#modifying-cumulus-tfmaintf" class="table-of-contents__link">Modifying <code>cumulus-tf/main.tf</code></a></li><li><a href="#modifying-cumulus-tfvariablestf" class="table-of-contents__link">Modifying <code>cumulus-tf/variables.tf</code></a></li><li><a href="#modifying-cumulus-tfterraformtfvars" class="table-of-contents__link">Modifying <code>cumulus-tf/terraform.tfvars</code></a></li></ul></li><li><a href="#configuring-orca-as-a-standalone-module-with-cumulus" class="table-of-contents__link">Configuring ORCA as a Standalone Module with Cumulus</a><ul><li><a href="#configure-terraform" class="table-of-contents__link">Configure Terraform</a></li><li><a href="#create-the-terraformtfvars-file" class="table-of-contents__link">Create the <code>terraform.tfvars</code> file.</a></li><li><a href="#create-the-variablestf-file" class="table-of-contents__link">Create the <code>variables.tf</code> file.</a></li><li><a href="#modifying-cumulus-tfterraformtfvars-1" class="table-of-contents__link">Modifying <code>cumulus-tf/terraform.tfvars</code></a></li></ul></li><li><a href="#define-the-orca-wokflows" class="table-of-contents__link">Define the ORCA Wokflows</a><ul><li><a href="#add-the-copy-to-glacier-step-to-an-ingest-workflow" class="table-of-contents__link">Add the Copy To Glacier Step to an Ingest Workflow</a></li><li><a href="#modify-the-recovery-workflow-optional" class="table-of-contents__link">Modify the Recovery Workflow (<em>OPTIONAL</em>)</a></li></ul></li><li><a href="#orca-variables" class="table-of-contents__link">ORCA Variables</a></li><li><a href="#deploy-orca-with-terraform" class="table-of-contents__link">Deploy ORCA with Terraform</a></li><li><a href="#collection-configuration" class="table-of-contents__link">Collection Configuration</a></li><li><a href="#enable-recover-granule-button" class="table-of-contents__link">Enable <code>Recover Granule</code> Button</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/about/introduction/orca-intro">About ORCA</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/developer/quickstart/developer-intro">ORCA Developer Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/cookbook/cookbook-intro">ORCA Cookbooks</a></li><li class="footer__item"><a class="footer__link-item" href="/cumulus-orca/docs/operator/operator-intro">ORCA Operator Guide</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/ORCA+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">ORCA Working Group</a></li><li class="footer__item"><a href="https://github.com/nasa/cumulus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Project</a></li><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/Cumulus+Integrators+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Integrator Working Group</a></li><li class="footer__item"><a href="https://wiki.earthdata.nasa.gov/display/CUMULUS/Cumulus+Operator+Working+Group" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Operator Working Group</a></li><li class="footer__item"><a href="https://nasa.github.io/cumulus/docs/cumulus-docs-readme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cumulus Documentation</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/nasa/cumulus-orca" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div></div></div></div></footer></div>
<script src="/cumulus-orca/styles.16303b44.js"></script>
<script src="/cumulus-orca/runtime~main.5db2d976.js"></script>
<script src="/cumulus-orca/main.0c1b3587.js"></script>
<script src="/cumulus-orca/2.32bf4f13.js"></script>
<script src="/cumulus-orca/42.f5120a7c.js"></script>
<script src="/cumulus-orca/43.774890db.js"></script>
<script src="/cumulus-orca/935f2afb.4905fe57.js"></script>
<script src="/cumulus-orca/41.66200ddc.js"></script>
<script src="/cumulus-orca/7c9fa1db.eadd3234.js"></script>
</body>
</html>