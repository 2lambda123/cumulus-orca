(self.webpackChunkorca_website=self.webpackChunkorca_website||[]).push([[7544],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return m},kt:function(){return c}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=s(a),c=i,k=u["".concat(p,".").concat(c)]||u[c]||d[c]||r;return a?n.createElement(k,o(o({ref:t},m),{},{components:a})):n.createElement(k,o({ref:t},m))}));function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},3919:function(e,t,a){"use strict";function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!n(e)}a.d(t,{b:function(){return n},Z:function(){return i}})},4996:function(e,t,a){"use strict";a.d(t,{C:function(){return r},Z:function(){return o}});var n=a(2263),i=a(3919);function r(){var e=(0,n.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,a=void 0===t?"/":t,r=e.url;return{withBaseUrl:function(e,t){return function(e,t,a,n){var r=void 0===n?{}:n,o=r.forcePrependBaseUrl,l=void 0!==o&&o,p=r.absolute,s=void 0!==p&&p;if(!a)return a;if(a.startsWith("#"))return a;if((0,i.b)(a))return a;if(l)return t+a;var m=a.startsWith(t)?a:t+a.replace(/^\//,"");return s?e+m:m}(r,a,e,t)}}}function o(e,t){return void 0===t&&(t={}),(0,r().withBaseUrl)(e,t)}},5804:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},metadata:function(){return p},toc:function(){return s},default:function(){return d}});var n=a(2122),i=a(9756),r=(a(7294),a(3905)),o=a(4996),l={id:"deploying-from-windows",title:"Deploy from Windows",description:"A concrete set of instructions on deploying from Windows to create a test environment."},p={unversionedId:"developer/deployment-guide/deploying-from-windows",id:"developer/deployment-guide/deploying-from-windows",isDocsHomePage:!1,title:"Deploy from Windows",description:"A concrete set of instructions on deploying from Windows to create a test environment.",source:"@site/docs/developer/deployment-guide/deploying-from-windows.mdx",sourceDirName:"developer/deployment-guide",slug:"/developer/deployment-guide/deploying-from-windows",permalink:"/cumulus-orca/docs/developer/deployment-guide/deploying-from-windows",editUrl:"https://github.com/nasa/cumulus-orca/edit/develop/website/docs/developer/deployment-guide/deploying-from-windows.mdx",version:"current",frontMatter:{id:"deploying-from-windows",title:"Deploy from Windows",description:"A concrete set of instructions on deploying from Windows to create a test environment."},sidebar:"dev_guide",previous:{title:"Testing Deployment",permalink:"/cumulus-orca/docs/developer/deployment-guide/testing_deployment"},next:{title:"Introduction to ORCA Research",permalink:"/cumulus-orca/docs/developer/research/research-intro"}},s=[{value:"Notes",id:"notes",children:[]},{value:"Application",id:"application",children:[]},{value:"Initial Setup",id:"initial-setup",children:[]},{value:"Cumulus",id:"cumulus",children:[]}],m={toc:s};function d(e){var t=e.components,a=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Deploying Cumulus, CumulusDashboard, and ORCA from Windows brings some additional challenges.\nThe goal of this page is to provide a set of modified instructions to get around common errors."),(0,r.kt)("h3",{id:"notes"},"Notes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Choose a PREFIX that will identify your installation when in AWS. This string will be used throughout deployment."),(0,r.kt)("li",{parentName:"ul"},"Connect to the NASA VPN to be able to connect to AWS.",(0,r.kt)("div",{parentName:"li",className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The VPN drastically slows down Terraform operations, and limits what documentation can be viewed. Switch off when applicable.")))),(0,r.kt)("li",{parentName:"ul"},"Commands here will use ",(0,r.kt)("inlineCode",{parentName:"li"},"us-west-2")," for region because of the current state of our sandbox and ESDIS recommendations. Replace consistently as needed.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Make sure any operations in AWS are done under the correct region.")))),(0,r.kt)("h2",{id:"application"},"Application"),(0,r.kt)("p",null,"This application will be used in future steps to authenticate users."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Go to ",(0,r.kt)("a",{parentName:"li",href:"https://uat.urs.earthdata.nasa.gov/profile"},"https://uat.urs.earthdata.nasa.gov/profile")),(0,r.kt)("li",{parentName:"ul"},"Applications -> My Applications",(0,r.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If this option is not present, then ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.earthdata.nasa.gov/display/EL/How+To+Register+An+Application"},'you must get the "Application Developer" permission.'))))),(0,r.kt)("li",{parentName:"ul"},"Create a new Application. Remember to update with your own prefix.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Application ID: ",(0,r.kt)("inlineCode",{parentName:"li"},"PREFIX_cumulus")),(0,r.kt)("li",{parentName:"ul"},"Application Name ",(0,r.kt)("inlineCode",{parentName:"li"},"PREFIX Cumulus")),(0,r.kt)("li",{parentName:"ul"},"Application Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"OAuth 2")),(0,r.kt)("li",{parentName:"ul"},"Redirect URL: For now, ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/"),". Proper URLs will be defined in the ",(0,r.kt)("a",{parentName:"li",href:"#redirect-definition"},"ORCA deployment"),".")))),(0,r.kt)("h2",{id:"initial-setup"},"Initial Setup"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Follow the ",(0,r.kt)("a",{parentName:"li",href:"/cumulus-orca/docs/developer/deployment-guide/deployment-environment"},"deployment environment setup instructions"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You may need to install Terraform manually."),(0,r.kt)("li",{parentName:"ul"},"Only configure the default profile."),(0,r.kt)("li",{parentName:"ul"},"Keep the access keys in plain-text. You will need to run ",(0,r.kt)("inlineCode",{parentName:"li"},"aws configure")," in multiple environments."))),(0,r.kt)("li",{parentName:"ul"},"Create an AWS Key Value Pair by following  ",(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html#having-ec2-create-your-key-pair"},"the AWS instructions"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Choose the '.pem' format."),(0,r.kt)("li",{parentName:"ul"},"Naming convention is PREFIX-key-pair.pem"))),(0,r.kt)("li",{parentName:"ul"},"Create buckets in the same OU and region as the other installations.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Same OU and region would not be ideal for a real backup system, but is generally sufficient for testing."),(0,r.kt)("li",{parentName:"ul"},"Required buckets are PREFIX-tf-state, PREFIX-orca-primary, PREFIX-internal, PREFIX-private, PREFIX-protected, and PREFIX-public",(0,r.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"An example command for creating a bucket in us-west-2. Remember to run ",(0,r.kt)("inlineCode",{parentName:"p"},"aws configure")," first."),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-commandline"},'aws s3api create-bucket --bucket PREFIX-tf-state --profile default --region us-west-2 --create-bucket-configuration "LocationConstraint=us-west-2"\n')))))))),(0,r.kt)("h2",{id:"cumulus"},(0,r.kt)("a",{parentName:"h2",href:"https://nasa.github.io/cumulus/docs/deployment/deployment-readme"},"Cumulus")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If creating a realistic setup with multiple OUs, apply ",(0,r.kt)("a",{parentName:"p",href:"/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket"},"Create the ORCA Archive Bucket")," to your PREFIX-orca-primary.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Run"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-commandline"},"aws dynamodb create-table --table-name PREFIX-tf-locks --attribute-definitions AttributeName=LockID,AttributeType=S --key-schema AttributeName=LockID,KeyType=HASH --billing-mode PAY_PER_REQUEST --region us-west-2\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Run"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-commandline"},"aws s3api put-bucket-versioning --bucket PREFIX-tf-state --versioning-configuration Status=Enabled\n")),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"VPC and Subnets are created by ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.earthdata.nasa.gov/display/ESKB/AWS+Services+Approval+Status+Page#AWSServicesApprovalStatusPage-VPC"},"NGAP"),".\nIt is recommended you copy values from an existing deployment setup.")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Go to ",(0,r.kt)("a",{parentName:"p",href:"https://git.earthdata.nasa.gov/projects/ORCA/repos/cumulus-orca-deploy-template/browse"},"this repo")," and clone it to your machine."),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"It is strongly recommended to use a tested release branch rather than master. These instructions have been tested with ",(0,r.kt)("inlineCode",{parentName:"p"},"release/v9.4.0-v3.0.1"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Unzip.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Remove the '.example' on terraform.tf and terraform.tfvars files in data-persistence-tf, cumulus-tf, and rds-cluster-tf.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Globally find and replace ",(0,r.kt)("inlineCode",{parentName:"p"},"postgres_user_pw")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"db_admin_password")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"database_app_user_pw")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"db_user_password"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In each terraform.tf and terraform.tfvars, use your own prefix, region, vpc id, and subnet ids."),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The region and prefix are not always in simple variables. Do a global search for 'PREFIX' and 'us-east-1'."))),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Only use the non-lambda subnet id in the data-persistence-tf/terraform.tfvars. In cumulus-tf use both."))),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Overwrite the ",(0,r.kt)("inlineCode",{parentName:"p"},"orca-sandbox")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"orca-sandbox-tf-locks")," with your prefix as well.")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In rds-cluster-tf/terraform.tfvars"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Use values of your choice for ",(0,r.kt)("inlineCode",{parentName:"li"},"db_admin_username")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"db_admin_password")),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"tags")," to ",(0,r.kt)("inlineCode",{parentName:"li"},'{ "Deployment" = "PREFIX" }')),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"permissions_boundary_arn")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"arn:aws:iam::YOUR ACCOUNT ID:policy/NGAPShRoleBoundary")),(0,r.kt)("li",{parentName:"ul"},"Add ",(0,r.kt)("inlineCode",{parentName:"li"},'rds_user_password = "CumulusD3faultPassw0rd"')," and change as desired."),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"provision_user_database")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster_identifier")," to ",(0,r.kt)("inlineCode",{parentName:"li"},'"PREFIX-cumulus-db"')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In rds-cluster-tf/terraform.tf"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"bucket")," to ",(0,r.kt)("inlineCode",{parentName:"li"},'"PREFIX-tf-state"')),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"key")," to ",(0,r.kt)("inlineCode",{parentName:"li"},'"PREFIX/cumulus/terraform.tfstate"')),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"dynamodb_table")," to ",(0,r.kt)("inlineCode",{parentName:"li"},'"PREFIX-tf-locks"')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Go to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/asfadmin/CIRRUS-core/blob/master/Dockerfile"},"https://github.com/asfadmin/CIRRUS-core/blob/master/Dockerfile")," and download the file to the same folder as your downloaded repo and orca folder."),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Make sure that no extension is added.")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Open a commandline in the same folder."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Run ",(0,r.kt)("inlineCode",{parentName:"li"},"docker build -t orca .")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"docker run -it --rm -v pathToYourFolder:/CIRRUS-core orca /bin/bash")),(0,r.kt)("li",{parentName:"ul"},"The commandline should now be inside a docker container.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd cumulus-orca-template-deploy/rds-cluster-tf/\naws configure\nterraform init\nterraform plan\nterraform apply\n"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In data-persistence-tf/terraform.tfvars"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"permissions_boundary_arn")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"arn:aws:iam::12345:policy/NGAPShRoleBoundary")," replacing the ",(0,r.kt)("inlineCode",{parentName:"li"},"12345")," with your Account Id.",(0,r.kt)("img",{alt:"Location of Account Id",src:(0,o.Z)("img/aws-account-id.PNG")})),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"rds_user_access_secret_arn")," to the ",(0,r.kt)("inlineCode",{parentName:"li"},"user_credentials_secret_urn")," output from ",(0,r.kt)("inlineCode",{parentName:"li"},"terraform apply"),"."),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"rds_security_group")," to the ",(0,r.kt)("inlineCode",{parentName:"li"},"security_group_id")," output from ",(0,r.kt)("inlineCode",{parentName:"li"},"terraform apply"),"."),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"vpc_id")," to your borrowed VPC.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ../data-persistence-tf/\naws configure\nterraform init\nterraform plan\nterraform apply\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In cumulus-tf/terraform.tfvars"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Replace 12345 in permissions_boundary_arn with the Account Id.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Add to the buckets:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'default_orca = {\n   name = "PREFIX-orca-primary"\n   type = "orca"\n  },\n  provider = {\n    name = "orca-sandbox-s3-provider"\n    type = "provider"\n}\n')),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},'The "orca-sandbox-s3-provider" bucket contains test data.\nIf creating a separate environment, you can create your own bucket.\nIt is recommended that all buckets include the same test data.')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If the CMA is not deployed, follow ",(0,r.kt)("a",{parentName:"p",href:"https://nasa.github.io/cumulus/docs/deployment/deployment-readme#deploy-the-cumulus-message-adapter-layer"},"the deployment instructions")," and note the version used. Must match ",(0,r.kt)("inlineCode",{parentName:"p"},"cumulus_message_adapter_version"),".\nIf you have already deployed your own CMA layer, it can be found using"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"aws lambda --profile default list-layers --query \"Layers[?LayerName=='PREFIX-CMA-layer'].[LayerName, LayerArn, LatestMatchingVersion.LayerVersionArn]\"\n")),(0,r.kt)("p",{parentName:"li"},":::")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Comment out the ",(0,r.kt)("inlineCode",{parentName:"p"},"ecs_cluster_instance_image_id"),". This will use the latest NGAP ECS image.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"ecs_cluster_instance_subnet_ids")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"lambda_subnet_ids")," should have the same two values.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Set ",(0,r.kt)("inlineCode",{parentName:"p"},"urs_client_id")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"urs_client_password")," to the values from your created application.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Add an extra property ",(0,r.kt)("inlineCode",{parentName:"p"},'urs_url = "https://uat.urs.earthdata.nasa.gov"'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Add your username to the ",(0,r.kt)("inlineCode",{parentName:"p"},"api_users")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"If you want all Orca developers to have access, set to",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'api_users = [\n  "bhazuka",\n  "andrew.dorn",\n  "rizbi.hassan",\n  "scott.saxon",\n]\n'))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Comment out the ",(0,r.kt)("inlineCode",{parentName:"p"},"archive_api_port")," property and value.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Uncomment the ",(0,r.kt)("inlineCode",{parentName:"p"},"key_name property")," and set the value to ",(0,r.kt)("inlineCode",{parentName:"p"},'"PREFIX-key-pair"'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Add this section to the bottom of the file and edit as desired:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'## =============================================================================\n## ORCA Variables\n## =============================================================================\n\n## REQUIRED TO BE SET\n## -----------------------------------------------------------------------------\n\n## ORCA application database user password.\ndb_user_password = "This1sAS3cr3t"\n\n## Default ORCA S3 Glacier bucket to use\norca_default_bucket = PREFIX-orca-primary"\n\n## PostgreSQL database (root) user password\ndb_admin_password = "An0th3rS3cr3t"\n')),(0,r.kt)("div",{parentName:"li",className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The instructions in the tfvars file suggest swapping '12345' with your account ID. This may not work, depending on how your dependencies were set up.")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In cumulus-tf/orca.tf:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Remove the ",(0,r.kt)("inlineCode",{parentName:"li"},"aws_profile")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"region")," variables."),(0,r.kt)("li",{parentName:"ul"},"Replace the ",(0,r.kt)("inlineCode",{parentName:"li"},"ORCA Variables")," section with the following:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'## --------------------------\n## ORCA Variables\n## --------------------------\n## REQUIRED\norca_default_bucket = var.orca_default_bucket\ndb_admin_password   = var.db_admin_password\ndb_user_password    = var.db_user_password\ndb_host_endpoint    = var.db_host_endpoint\n## OPTIONAL\ndb_admin_username                                    = "postgres"\norca_ingest_lambda_memory_size                       = 2240\norca_ingest_lambda_timeout                           = 600\norca_recovery_buckets                                = []\norca_recovery_complete_filter_prefix                 = ""\norca_recovery_expiration_days                        = 5\norca_recovery_lambda_memory_size                     = 128\norca_recovery_lambda_timeout                         = 300\norca_recovery_retry_limit                            = 3\norca_recovery_retry_interval                         = 1\norca_recovery_retry_backoff                          = 2\nsqs_delay_time_seconds                               = 0\nsqs_maximum_message_size                             = 262144\nstaged_recovery_queue_message_retention_time_seconds = 432000\nstatus_update_queue_message_retention_time_seconds   = 777600\n'))),(0,r.kt)("li",{parentName:"ul"},"Set the value of ",(0,r.kt)("inlineCode",{parentName:"li"},"db_host_endpoint")," to the ",(0,r.kt)("inlineCode",{parentName:"li"},"rds_endpoint")," value output from the rds-cluster deployment."),(0,r.kt)("li",{parentName:"ul"},"You may change ",(0,r.kt)("inlineCode",{parentName:"li"},"source")," to an alternate release. If local, make sure it is within the scope of the container.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ../cumulus-tf\nterraform init\nterraform plan\nterraform apply\n")),(0,r.kt)("a",{name:"redirect-definition"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Go to ",(0,r.kt)("a",{parentName:"li",href:"https://uat.urs.earthdata.nasa.gov/profile"},"https://uat.urs.earthdata.nasa.gov/profile")),(0,r.kt)("li",{parentName:"ul"},"Applications -> My Applications"),(0,r.kt)("li",{parentName:"ul"},"Click on the Edit button for your application."),(0,r.kt)("li",{parentName:"ul"},"Click on Manage -> Redirect Uris"),(0,r.kt)("li",{parentName:"ul"},"Add http://localhost:3000/auth and the ",(0,r.kt)("inlineCode",{parentName:"li"},"archive_api_redirect_uri")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"distribution_redirect_uri")," output from ",(0,r.kt)("inlineCode",{parentName:"li"},"terraform apply"),".")))}d.isMDXComponent=!0}}]);