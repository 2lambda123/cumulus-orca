"use strict";(self.webpackChunkorca_website=self.webpackChunkorca_website||[]).push([[1455],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(n),m=o,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8794:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return c},metadata:function(){return l},toc:function(){return p}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],c={id:"deployment-s3-bucket",title:"Creating the Glacier Bucket",description:"Provides developer with information on archive storage solutions."},s=void 0,l={unversionedId:"developer/deployment-guide/deployment-s3-bucket",id:"developer/deployment-guide/deployment-s3-bucket",title:"Creating the Glacier Bucket",description:"Provides developer with information on archive storage solutions.",source:"@site/docs/developer/deployment-guide/creating-orca-glacier-bucket.md",sourceDirName:"developer/deployment-guide",slug:"/developer/deployment-guide/deployment-s3-bucket",permalink:"/cumulus-orca/docs/developer/deployment-guide/deployment-s3-bucket",draft:!1,editUrl:"https://github.com/nasa/cumulus-orca/edit/develop/website/docs/developer/deployment-guide/creating-orca-glacier-bucket.md",tags:[],version:"current",frontMatter:{id:"deployment-s3-bucket",title:"Creating the Glacier Bucket",description:"Provides developer with information on archive storage solutions."},sidebar:"dev_guide",previous:{title:"Creating a Deployment Environment",permalink:"/cumulus-orca/docs/developer/deployment-guide/deployment-environment"},next:{title:"Deploying ORCA with Cumulus",permalink:"/cumulus-orca/docs/developer/deployment-guide/deployment-with-cumulus"}},u={},p=[{value:"Create the ORCA Archive and Report Buckets",id:"create-the-orca-archive-and-report-buckets",level:2},{value:"Provide Cross Account (OU) Access",id:"provide-cross-account-ou-access",level:2},{value:"Filling out the form",id:"filling-out-the-form",level:3},{value:"Project Name",id:"project-name",level:4},{value:"Account Type:",id:"account-type",level:4},{value:"Business Justification:",id:"business-justification",level:4},{value:"Bucket Names(s):",id:"bucket-namess",level:4},{value:"Policy:",id:"policy",level:4},{value:"Archive Bucket:",id:"archive-bucket",level:5},{value:"Reports Bucket:",id:"reports-bucket",level:5}],d={toc:p};function m(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"ORCA maintains a cloud ready backup of science and ancillary data in an\n",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/s3/storage-classes/#Infrequent_access"},"S3-IA"),"\nbucket and utilizes ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonS3/latest/dev/lifecycle-transition-general-considerations.html"},"AWS bucket transition policies"),"\nto store the data in ",(0,r.kt)("a",{parentName:"p",href:"/cumulus-orca/docs/about/introduction/intro-glossary#glacier-storage"},"S3 Glacier"),"\nfor the long term. The ORCA archive bucket can live in any NGAP Organizational\nUnit (OU)."),(0,r.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"ORCA S3 Glacier Bucket OU Placement")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Best practice is to place the ORCA archive bucket in your Disaster Recovery OU.\nThis is done to better separate the costs associated with the cloud ready backup\nfrom primary Cumulus holdings and ingest and archive activity. See the\n",(0,r.kt)("a",{parentName:"p",href:"/cumulus-orca/docs/about/architecture/architecture-intro"},"ORCA Architecture Introduction documentation"),"\nfor more information."))),(0,r.kt)("p",null,"The sections below go into further detail on creating the ORCA archive bucket."),(0,r.kt)("h2",{id:"create-the-orca-archive-and-report-buckets"},"Create the ORCA Archive and Report Buckets"),(0,r.kt)("p",null,"Prior to creating the S3 buckets, make sure the deployment environment is created\nper the ",(0,r.kt)("a",{parentName:"p",href:"/cumulus-orca/docs/developer/deployment-guide/deployment-environment"},"Creating the Deployment Environment"),"\ndocumentation."),(0,r.kt)("p",null,"To create the ORCA buckets run the AWS CLI command below twice, once for your archive bucket and once for your report bucket.\nReplace the ","[","place holder text","]"," with proper values for your deployment."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'aws s3api create-bucket \\\n    --bucket [orca bucket name] \\\n    --profile [AWS OU profile]  \\\n    --region us-west-2 \\\n    --create-bucket-configuration "LocationConstraint=us-west-2"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"[","orca bucket name","]")," - This is the name of your bucket. Example: ",(0,r.kt)("inlineCode",{parentName:"li"},"sandbox-orca-glacier-archive")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"sandbox-orca-reports")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"[","AWS OU profile","]")," - This is the AWS profile name to use to connect to the proper OU where the bucket will be created.")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"--region us-west-2")," and ",(0,r.kt)("inlineCode",{parentName:"p"},'--create-bucket-configuration "LocationConstraint=us-west-2"'),"\nlines are only necessary if you are creating your bucket outside of ",(0,r.kt)("strong",{parentName:"p"},"us-east-1"),"."))),(0,r.kt)("p",null,"For more information on creating an S3 bucket, see the\n",(0,r.kt)("a",{parentName:"p",href:"http://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html"},'AWS "Creating a Bucket" documentation'),"\nand the ",(0,r.kt)("a",{parentName:"p",href:"https://nasa.github.io/cumulus/docs/deployment/create_bucket"},'Cumulus "Creating an S3 Bucket" documentation'),"."),(0,r.kt)("h2",{id:"provide-cross-account-ou-access"},"Provide Cross Account (OU) Access"),(0,r.kt)("p",null,"Per best practice, the ORCA archive bucket will be created in the Disaster\nRecovery OU and the additional ORCA components will be created in the Cumulus OU.\nIn order for the components in the Cumulus OU to interact with the ORCA archive\nbucket in the Cumulus OU, cross account bucket access privileges are needed. This\nsection details the steps needed to request the cross account bucket access."),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Deploying ORCA with Objects in Different OUs")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you are following best practice and have created your ORCA archive bucket in\nthe Disaster Recovery OU, you must have cross account bucket access permissions\ncreated and enabled before deploying the ORCA code. If you do not, your deployment\nwill return with the following error."),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre"},"module.orca.module.orca_lambdas.aws_s3_bucket_notification.copy_lambda_trigger: Creating...\n\nError: Error putting S3 notification configuration: AccessDenied: Access Denied\n    status code: 403, request id: 2E31C2ACD124B50B, host id: 0JrRBUioe/gT......\n")))),(0,r.kt)("h3",{id:"filling-out-the-form"},"Filling out the form"),(0,r.kt)("p",null,"First, create a NASD ticket for cross account bucket access. This is a turn key\nrequest to NGAP. The link to create a ticket is available\n",(0,r.kt)("a",{parentName:"p",href:"https://bugs.earthdata.nasa.gov/servicedesk/customer/portal/7/create/80"},"here"),"."),(0,r.kt)("p",null,"Next, fill out the form. The sections below provide information on the data needed\nfor each of the fields and where to look for information."),(0,r.kt)("h4",{id:"project-name"},"Project Name"),(0,r.kt)("p",null,"This is the name of the Disaster Recover OU where the ORCA archive bucket resides.\nThe project name can be found in your ",(0,r.kt)("a",{parentName:"p",href:"http://cloud.earthdata.nasa.gov/"},"Cloud Tamer"),"\naccount and is usually in the format of ","[","project name","]","-app-","[","application name","]","-","[","environment","]","-","[","4 digit number","]",".\nFor example, an ORCA disaster recovery OU project name may look like the following\norca-app-dr-sandbox-1234."),(0,r.kt)("h4",{id:"account-type"},"Account Type:"),(0,r.kt)("p",null,"This is the OU environment the bucket resides in. Typical values for this field\nare Sandbox, SIT, UAT, and Production."),(0,r.kt)("h4",{id:"business-justification"},"Business Justification:"),(0,r.kt)("p",null,"This is the business justification for the cross account bucket access. Below is\nan example of a justification."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The ORCA Cumulus application in the Cumulus Sandbox OU needs to read/write to\nthe ORCA DR account S3 buckets in order to create an operational archive copy of\nORCA data and recover data back to the primary Cumulus data holdings in case\nof a failure. Note that only ",(0,r.kt)("inlineCode",{parentName:"p"},"GLACIER")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"DEEP_ARCHIVE")," storage types are allowed for objects written to the bucket. This cross account access will allow the Cumulus application to\nseamlessly perform these functions and provide operators with the capability to\ntest and verify disaster recovery scenarios.")),(0,r.kt)("h4",{id:"bucket-namess"},"Bucket Names(s):"),(0,r.kt)("p",null,"This is the name of the ORCA archive bucket created in the Disaster Recover OU.\nBelow is an example name of an ORCA archive bucket and ORCA report bucket."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"sandbox-orca-glacier-archive\nsandbox-orca-reports")),(0,r.kt)("h4",{id:"policy"},"Policy:"),(0,r.kt)("p",null,"The policy section is the JSON policy requested for the ORCA archive bucket in\nthe Disaster Recovery OU."),(0,r.kt)("h5",{id:"archive-bucket"},"Archive Bucket:"),(0,r.kt)("p",null,"The policy shown below can be used with some minor\nmodifications, which will be detailed below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "Version":"2012-10-17",\n   "Statement":[\n      {\n         "Sid":"Cross Account Access",\n         "Effect":"Allow",\n         "Principal":{\n            "AWS":"arn:aws:iam::012345678912:root"\n         },\n         "Action":[\n            "s3:GetObject*",\n            "s3:RestoreObject",\n            "s3:GetBucket*",\n            "s3:ListBucket",\n            "s3:PutBucketNotification",\n            "s3:GetInventoryConfiguration",\n            "s3:PutInventoryConfiguration",\n            "s3:ListBucketVersions"\n         ],\n         "Resource":[\n            "arn:aws:s3:::sandbox-orca-glacier-archive",\n            "arn:aws:s3:::sandbox-orca-glacier-archive/*"\n         ]\n      },\n      {\n         "Sid":"Cross Account Write Access",\n         "Effect":"Allow",\n         "Principal":{\n            "AWS":"arn:aws:iam::012345678912:root"\n         },\n         "Action":"s3:PutObject*",\n         "Resource":[\n            "arn:aws:s3:::sandbox-orca-glacier-archive/*"\n         ],\n         "Condition":{\n            "StringEquals":{\n               "s3:x-amz-acl":"bucket-owner-full-control",\n               "s3:x-amz-storage-class":[\n                  "GLACIER",\n                  "DEEP_ARCHIVE"\n               ]\n            }\n         }\n      }\n   ]\n}\n')),(0,r.kt)("p",null,"The Principal value is the AWS root user for your Cumulus application that will\naccess the ORCA archive bucket. The value for this can be retrieved by\nperforming the following."),(0,r.kt)("p",null,"First, change your connection to the Cumulus account/OU rather than the Disaster Recovery account/OU.\nThen, using your AWS CLI client run the following command to get the account number:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'aws sts get-caller-identity\n\n{\n    "UserId": "ABCWXYZ123...",\n    "Account": "90912...",\n    "Arn": "arn:aws:iam::90912...:user/NGAPShApplicationDeveloper-someone-123"\n}\n')),(0,r.kt)("p",null,"Replace the number in ",(0,r.kt)("inlineCode",{parentName:"p"},"arn:aws:iam::012345678912:root")," with the value of your account number."),(0,r.kt)("p",null,"The Resource value is the bucket and bucket paths that the Cumulus application\ncan access. Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"sandbox-orca-glacier-archive")," with the name\nof the Orca archive bucket created in the previous section."),(0,r.kt)("h5",{id:"reports-bucket"},"Reports Bucket:"),(0,r.kt)("p",null,"The policy shown below can be used with some minor\nmodifications, which will be detailed below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "Cross Account Access",\n      "Effect": "Allow",\n      "Principal": {\n        "AWS": "arn:aws:iam::012345678912:root"\n      },\n      "Action": [\n        "s3:GetObject*",\n        "s3:GetBucket*",\n        "s3:ListBucket",\n        "s3:PutObject",\n        "s3:PutObjectAcl",\n        "s3:PutBucketNotification"\n      ],\n      "Resource": [\n        "arn:aws:s3:::sandbox-orca-glacier-archive",\n        "arn:aws:s3:::sandbox-orca-glacier-archive/*"\n      ]\n    },\n    {\n      "Sid": "Inventory-sandbox-orca-glacier-archive",\n      "Effect": "Allow",\n      "Principal": {\n        "Service": "s3.amazonaws.com"\n      },\n      "Action": "s3:PutObject",\n      "Resource": "arn:aws:s3:::sandbox-orca-glacier-archive/*",\n      "Condition": {\n        "StringEquals": {\n          "s3:x-amz-acl": "bucket-owner-full-control",\n          "aws:SourceAccount": "000000000000"\n        },\n        "ArnLike": {\n          "aws:SourceArn": "arn:aws:s3:::sandbox-orca-glacier-archive"\n        }\n      }\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"The Principal value is the AWS root user for your Cumulus application that will\naccess the ORCA archive bucket.\nSee the Archive Bucket instructions for assistance getting this value."),(0,r.kt)("p",null,"Replace the number in ",(0,r.kt)("inlineCode",{parentName:"p"},"arn:aws:iam::012345678912:root")," with the value of your account number.\nSee the Archive Bucket instructions for assistance getting this value."),(0,r.kt)("p",null,"Replace the number ",(0,r.kt)("inlineCode",{parentName:"p"},"000000000000")," with your DR account number."),(0,r.kt)("p",null,"The Resource value is the bucket and bucket paths that the Cumulus application\ncan access. Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"sandbox-orca-glacier-archive")," with the name\nof the Orca archive bucket created in the previous section."))}m.isMDXComponent=!0}}]);